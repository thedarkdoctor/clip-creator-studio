# ðŸ“‹ Lynkscope â†’ Cliplyst Integration Requirements & Checklist

**This file contains everything Lynkscope needs to know to integrate with Cliplyst.**

---

## Required Environment Variables

Add these to Lynkscope's environment configuration:

```env
# Cliplyst API Integration
VITE_CLIPLYST_API_URL=https://cliplyst-content-maker.onrender.com

# Lynkscope â†” Cliplyst Shared Credentials
VITE_LYNKSCOPE_INTERNAL_KEY=a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6

# Session Token Signing
JWT_SECRET=0123456789abcdef0123456789abcdef
```

**Where to get these values:**

1. **VITE_CLIPLYST_API_URL**: Cliplyst team provides this (production URL)
2. **VITE_LYNKSCOPE_INTERNAL_KEY**: Generated by Cliplyst team (`openssl rand -hex 16`)
3. **JWT_SECRET**: Generated by Cliplyst team (`openssl rand -hex 16`)

**Contact**: Request credentials from Cliplyst team at [support@cliplyst.com]

---

## API Endpoints Available

### 1. Health Check

**GET** `/api/health`

Check if Cliplyst is operational.

```bash
curl https://cliplyst-content-maker.onrender.com/api/health

# Response (200 OK):
{
  "status": "ok",
  "version": "1.0",
  "services": {
    "api": "operational",
    "supabase": "connected",
    "buffer": "ready",
    "external_apis": "ready"
  }
}
```

---

### 2. Create Content Job

**POST** `/api/jobs/create-content`

Submit a content creation request to Cliplyst.

**Authentication**: Bearer token in Authorization header

**Headers**:
```
Authorization: Bearer VITE_LYNKSCOPE_INTERNAL_KEY
Content-Type: application/json
```

**Request Body**:
```json
{
  "user_id": "string (uuid or user identifier)",
  "company_name": "string (brand name)",
  "niche": "string (supported niche)",
  "weak_platforms": ["string array (social media platforms)"],
  "top_opportunities": ["string array (marketing opportunities)"],
  "auto_schedule": "boolean (auto-schedule future videos)",
  "posting_frequency": "string (daily|thrice_weekly|weekly|monthly)"
}
```

**Example**:
```bash
curl -X POST https://cliplyst-content-maker.onrender.com/api/jobs/create-content \
  -H "Authorization: Bearer a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "lynkscope-user-123",
    "company_name": "FitMax Training",
    "niche": "fitness",
    "weak_platforms": ["tiktok", "instagram", "youtube"],
    "top_opportunities": ["short form tutorials", "fitness challenges"],
    "auto_schedule": true,
    "posting_frequency": "weekly"
  }'
```

**Response (202 Accepted)**:
```json
{
  "status": "accepted",
  "job_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Content generation job queued successfully"
}
```

**Response Codes**:
- `202 Accepted` - Job queued successfully (use job_id to poll status)
- `400 Bad Request` - Missing or invalid fields
- `401 Unauthorized` - Invalid or missing Authorization header
- `500 Internal Server Error` - Server error (retry after 30 seconds)

**Supported Niches**:
```
fitness, marketing, beauty, fashion, food, comedy, dance, music, 
gaming, lifestyle, education, pets, travel, motivation, relationship
```

---

### 3. Get Job Status

**GET** `/api/jobs/{jobId}`

Poll the status of a content creation job.

**Authentication**: Bearer token in Authorization header

**Headers**:
```
Authorization: Bearer VITE_LYNKSCOPE_INTERNAL_KEY
```

**Example**:
```bash
curl -X GET https://cliplyst-content-maker.onrender.com/api/jobs/550e8400-e29b-41d4-a716-446655440000 \
  -H "Authorization: Bearer a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6"
```

**Response (200 OK)**:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "processing",
  "company_name": "FitMax Training",
  "niche": "fitness",
  "weak_platforms": ["tiktok", "instagram", "youtube"],
  "opportunities": ["short form tutorials", "fitness challenges"],
  "progress": {
    "trends_discovered": 3,
    "scripts_generated": 2,
    "videos_created": 1,
    "scheduled": 1
  },
  "result_videos": [
    {
      "id": "video-001",
      "url": "https://storage.supabase.io/v1/object/public/videos/...",
      "caption": "Transform your fitness journey with professional coaching",
      "hashtags": ["#fitness", "#motivation", "#gym"],
      "scheduled_for": "2026-02-08T10:00:00Z",
      "platform": "tiktok"
    }
  ],
  "created_at": "2026-02-01T12:00:00Z",
  "updated_at": "2026-02-01T12:15:30Z"
}
```

**Status Values**:
- `pending` - Job created, waiting to start
- `processing` - Actively creating content
- `complete` - Finished successfully, videos available
- `failed` - Error occurred, check error_message field

**Response Codes**:
- `200 OK` - Job found, status returned
- `401 Unauthorized` - Invalid or missing Authorization header
- `404 Not Found` - Job ID not found
- `500 Internal Server Error` - Server error

---

## Integration Steps

### Step 1: Get Credentials from Cliplyst

Contact Cliplyst team and request:
- âœ… Cliplyst API URL (production endpoint)
- âœ… VITE_LYNKSCOPE_INTERNAL_KEY (random 32-char hex)
- âœ… JWT_SECRET (random 32-char hex)
- âœ… CORS whitelist confirmation (Lynkscope domain added)

### Step 2: Configure Lynkscope Environment

```bash
# Update .env or deployment platform environment:
VITE_CLIPLYST_API_URL=https://cliplyst-content-maker.onrender.com
VITE_LYNKSCOPE_INTERNAL_KEY=a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6
JWT_SECRET=0123456789abcdef0123456789abcdef
```

### Step 3: Implement Job Creation

In Lynkscope, add a function to create content jobs:

```typescript
// services/cliplystService.ts
async function createContentJob(payload: {
  user_id: string;
  company_name: string;
  niche: string;
  weak_platforms: string[];
  top_opportunities: string[];
  auto_schedule: boolean;
  posting_frequency: string;
}): Promise<{ job_id: string }> {
  const response = await fetch(
    `${import.meta.env.VITE_CLIPLYST_API_URL}/api/jobs/create-content`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${import.meta.env.VITE_LYNKSCOPE_INTERNAL_KEY}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    }
  );

  if (!response.ok) {
    const error = await response.json();
    throw new Error(`Failed to create job: ${error.message}`);
  }

  const data = await response.json();
  return { job_id: data.job_id };
}
```

### Step 4: Implement Status Polling

```typescript
async function getJobStatus(jobId: string) {
  const response = await fetch(
    `${import.meta.env.VITE_CLIPLYST_API_URL}/api/jobs/${jobId}`,
    {
      headers: {
        'Authorization': `Bearer ${import.meta.env.VITE_LYNKSCOPE_INTERNAL_KEY}`,
      },
    }
  );

  if (!response.ok) {
    throw new Error('Failed to get job status');
  }

  return await response.json();
}

// Poll until complete or failed
async function waitForJobCompletion(jobId: string, maxWaitMs = 3600000) {
  const startTime = Date.now();
  const pollIntervalMs = 10000; // Poll every 10 seconds

  while (Date.now() - startTime < maxWaitMs) {
    const job = await getJobStatus(jobId);

    if (job.status === 'complete') {
      return job;
    }

    if (job.status === 'failed') {
      throw new Error(`Job failed: ${job.error_message}`);
    }

    // Still processing, wait and retry
    await new Promise(resolve => setTimeout(resolve, pollIntervalMs));
  }

  throw new Error('Job polling timeout');
}
```

### Step 5: Deploy & Test

```bash
# Deploy Lynkscope with new configuration
git push origin main

# Test job creation
curl -X POST https://cliplyst-content-maker.onrender.com/api/jobs/create-content \
  -H "Authorization: Bearer YOUR_KEY" \
  -H "Content-Type: application/json" \
  -d '{...payload...}'

# Verify response: should be 202 Accepted with job_id
```

---

## Error Handling

### Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| 401 Unauthorized | Invalid API key | Verify VITE_LYNKSCOPE_INTERNAL_KEY matches Cliplyst's value |
| 400 Bad Request | Missing/invalid fields | Check all required fields present and correct type |
| 404 Not Found | Job ID invalid | Verify job_id from creation response |
| 500 Internal Server Error | Server issue | Retry after 30 seconds, check logs |
| CORS error | Domain not whitelisted | Contact Cliplyst to whitelist your Lynkscope domain |

### Retry Logic

Implement exponential backoff for transient failures:

```typescript
async function createJobWithRetry(payload: any, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await createContentJob(payload);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      
      const delayMs = 1000 * Math.pow(2, i); // 1s, 2s, 4s
      await new Promise(resolve => setTimeout(resolve, delayMs));
    }
  }
}
```

---

## Security Requirements

1. **HTTPS Only**: All API calls must use HTTPS
2. **Bearer Token**: Include token in Authorization header
3. **Never Log Credentials**: Don't log API keys in error messages
4. **Validate SSL**: Verify SSL certificate on production
5. **Rate Limiting**: Limit to reasonable request rate (e.g., 10 jobs/minute)

---

## Testing Checklist

Before going live:

- [ ] Credentials loaded correctly in Lynkscope env
- [ ] Health check endpoint responds (200 OK)
- [ ] Can create content job (202 Accepted)
- [ ] Can poll job status (200 OK)
- [ ] Job processing completes successfully
- [ ] Videos generated and accessible
- [ ] Error handling works correctly
- [ ] CORS working from Lynkscope domain
- [ ] No credentials logged in output/errors
- [ ] Load testing passed (if applicable)

---

## Support & Issues

**For integration issues:**

1. Verify all credentials configured correctly
2. Check Cliplyst health endpoint: `/api/health`
3. Verify Bearer token format: `Authorization: Bearer YOUR_KEY`
4. Check CORS headers in browser developer tools
5. Review Cliplyst logs for detailed error messages
6. Contact Cliplyst support with job ID for investigation

**Contact**: [support@cliplyst.com]

---

## API Reference Summary

| Method | Endpoint | Auth | Purpose |
|--------|----------|------|---------|
| GET | `/api/health` | No | Check system status |
| POST | `/api/jobs/create-content` | Bearer | Create content job |
| GET | `/api/jobs/{jobId}` | Bearer | Get job status |

---

**Version**: 1.0  
**Last Updated**: February 1, 2026  
**Status**: âœ… Ready for Integration
